{% extends "base.html" %}
{% block title %}Analytics Dashboard - EcoPackAI{% endblock %}
{% block page_title %}Advanced Analytics{% endblock %}

{% block extra_css %}
<style>
    .fade-in {
        animation: fadeIn 0.6s ease-in-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(15px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .metric-tile {
        border-radius: 16px;
        padding: 1.6rem;
        color: #000;
        box-shadow: 0 6px 18px rgba(0, 0, 0, .08);
        transition: transform .3s ease;
        height: 100%;
    }

    .metric-tile:hover {
        transform: translateY(-6px);
    }

    .metric-tile small {
        font-weight: 600;
        text-transform: uppercase;
        opacity: .7;
        font-size: 0.85rem;
    }

    .metric-tile h2,
    .metric-tile h4 {
        margin-top: .5rem;
        font-weight: 800;
    }

    .metric-tile.green {
        background: linear-gradient(135deg, #d1e7dd, #ffffff);
        border-left: 4px solid #198754;
    }

    .metric-tile.blue {
        background: linear-gradient(135deg, #cfe2ff, #ffffff);
        border-left: 4px solid #0d6efd;
    }

    .metric-tile.yellow {
        background: linear-gradient(135deg, #fff3cd, #ffffff);
        border-left: 4px solid #ffc107;
    }

    .metric-tile.red {
        background: linear-gradient(135deg, #f8d7da, #ffffff);
        border-left: 4px solid #dc3545;
    }

    .chart-card {
        border-radius: 18px;
        transition: transform .3s ease;
        border: 1px solid rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }

    .chart-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }

    .chart-header {
        background: linear-gradient(135deg, #198754, #0f5132);
        color: white;
        padding: 1rem 1.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .insight-card {
        background: #f8f9fa;
        border-radius: 14px;
        padding: 1.5rem;
        border-left: 5px solid #198754;
        transition: all .3s ease;
        height: 100%;
    }

    .insight-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 10px 24px rgba(0, 0, 0, .15);
    }

    .export-btn {
        border-radius: 10px;
        padding: 0.5rem 1.5rem;
        font-weight: 600;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4 fade-in" id="dashboardContent">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
        <div>
            <h3 class="fw-bold mb-1 text-success">
                <i class="fas fa-chart-line me-2"></i>Analytics Dashboard
            </h3>
            <p class="text-muted mb-0">Track your environmental impact and savings</p>
        </div>

        <div class="btn-group">
            <button type="button" class="btn btn-success dropdown-toggle export-btn" data-bs-toggle="dropdown">
                <i class="fas fa-download me-1"></i> Export Report
            </button>
            <ul class="dropdown-menu dropdown-menu-end shadow">
                <li>
                    <a class="dropdown-item" href="#" onclick="EcoPackAI.AnalyticsService.exportReport('pdf')">
                        <i class="fas fa-file-pdf me-2 text-danger"></i> PDF
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="#" onclick="EcoPackAI.AnalyticsService.exportReport('excel')">
                        <i class="fas fa-file-excel me-2 text-success"></i> Excel
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="#" onclick="EcoPackAI.AnalyticsService.exportReport('csv')">
                        <i class="fas fa-file-csv me-2 text-primary"></i> CSV
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <!-- METRICS -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="metric-tile green">
                <small>Avg CO₂ Reduction</small>
                <h2 id="avgCO2">0%</h2>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric-tile blue">
                <small>Avg Cost Savings</small>
                <h2 id="avgCost">0%</h2>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric-tile yellow">
                <small>Recommendations</small>
                <h2 id="totalRecs">0</h2>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric-tile red">
                <small>Top Material</small>
                <h4 id="topMaterial">—</h4>
            </div>
        </div>
    </div>

    <!-- CHARTS -->
    <div class="row g-4 mb-4">
        <div class="col-md-8">
            <div class="card shadow-sm chart-card">
                <div class="chart-header">
                    <h6 class="mb-0"><i class="fas fa-cloud me-2"></i>CO₂ Reduction Trend</h6>
                </div>
                <div class="card-body p-3">
                    <div id="co2Chart" style="height:350px;">
                        <div class="d-flex justify-content-center align-items-center h-100 text-muted">
                            <div class="spinner-border spinner-border-sm me-2"></div> Loading chart...
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm chart-card">
                <div class="chart-header">
                    <h6 class="mb-0"><i class="fas fa-layer-group me-2"></i>Top Materials</h6>
                </div>
                <div class="card-body p-3">
                    <div id="materialChart" style="height:350px;">
                        <div class="d-flex justify-content-center align-items-center h-100 text-muted">
                            <div class="spinner-border spinner-border-sm me-2"></div> Loading chart...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-5">
        <div class="col-md-12">
            <div class="card shadow-sm chart-card">
                <div class="chart-header">
                    <h6 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Recommendation Score Distribution</h6>
                </div>
                <div class="card-body p-3">
                    <div id="scoreChart" style="height:350px;">
                        <div class="d-flex justify-content-center align-items-center h-100 text-muted">
                            <div class="spinner-border spinner-border-sm me-2"></div> Loading chart...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- INSIGHTS -->
    <div class="row g-4">
        <div class="col-12">
            <h4 class="fw-bold mb-3 text-success">
                <i class="fas fa-lightbulb me-2"></i>Material Insights
            </h4>
        </div>
        <div class="row g-4" id="insightsContainer">
            <div class="col-12 text-center py-4">
                <div class="spinner-border text-success"></div>
                <p class="mt-2 text-muted">Loading insights...</p>
            </div>
        </div>
    </div>
</div>

<script>
    // Dashboard data is loaded by main.js automatically based on the URL path
</script>
{% endblock %}